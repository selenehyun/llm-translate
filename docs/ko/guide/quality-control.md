# 품질 관리

llm-translate는 Self-Refine 알고리즘을 사용하여 번역 품질이 귀사의 요구사항을 충족하도록 보장합니다.

## Self-Refine 작동 방식

```
┌─────────────────┐
│ Initial Translate│
└────────┬────────┘
         ▼
┌─────────────────┐
│ Evaluate Quality │◀──────────────┐
└────────┬────────┘               │
         ▼                        │
    Score >= Threshold?           │
         │                        │
    No   │   Yes                  │
         │    │                   │
         ▼    ▼                   │
┌─────────┐ ┌──────┐              │
│ Reflect │ │ Done │              │
└────┬────┘ └──────┘              │
     ▼                            │
┌─────────────────┐               │
│    Improve      │───────────────┘
└─────────────────┘
```

### 1. 초기 번역

첫 번째 번역은 다음과 함께 생성됩니다:
- 전체 용어집 컨텍스트
- 문서 구조 정보
- 이전 청크 컨텍스트 (연속성을 위해)

### 2. 품질 평가

각 번역은 네 가지 기준으로 채점됩니다:

| 기준 | 가중치 | 설명 |
|-----------|--------|-------------|
| 의미 정확성 | 40% | 올바른 의미를 전달합니까? |
| 유창성 | 25% | 대상 언어에서 자연스럽게 읽힙니까? |
| 용어집 준수 | 20% | 모든 용어집 용어가 올바르게 적용되었습니까? |
| 형식 보존 | 15% | Markdown/HTML 구조가 유지되었습니까? |

### 3. 반영

품질이 품질 임계값 미만이면 LLM은 다음을 분석합니다:
- 어떤 특정 문제가 존재하는지
- 어떤 용어집 용어가 누락되었는지
- 유창성을 어디서 개선할 수 있는지

### 4. 개선

반영 피드백을 기반으로 대상 수정이 적용되고 주기가 반복됩니다.

## 구성

### 품질 임계값

```bash
# CLI
llm-translate file doc.md -o doc.ko.md --target ko --quality 90

# Config file
{
  "translation": {
    "qualityThreshold": 90
  }
}
```

### 최대 반복 횟수

```bash
# CLI
llm-translate file doc.md -o doc.ko.md --target ko --max-iterations 6

# Config file
{
  "translation": {
    "maxIterations": 6
  }
}
```

### 엄격한 모드

품질 임계값을 충족하지 못하면 실패합니다:

```bash
llm-translate file doc.md -o doc.ko.md --target ko --strict
```

종료 코드:
-`0`- 성공
-`4`- 품질 임계값 미충족 (엄격한 모드)

## 품질 점수 해석

| 점수 | 품질 수준 | 설명 |
|-------|--------------|-------------|
| 95-100 | 우수 | 출판 준비 완료 |
| 85-94 | 좋음 | 경미한 문제, 대부분의 용도에 허용 가능 |
| 75-84 | 보통 | 눈에 띄는 문제, 검토 필요할 수 있음 |
| 60-74 | 부족 | 심각한 문제, 수동 검토 필요 |
| < 60 | 허용 불가 | 주요 문제, 재번역 고려 |

## 출력 이해

```
✓ Translation complete
  Quality: 92/85 (threshold met)
  Breakdown:
    - Accuracy: 38/40
    - Fluency: 24/25
    - Glossary: 18/20
    - Format: 12/15
  Iterations: 2
```

### 세부 분석

- **정확성 (38/40)**: 번역이 의미상 정확합니다
- **유창성 (24/25)**: 대상 언어에서 자연스럽게 읽힙니다
- **용어집 (18/20)**: 대부분의 용어가 적용되었으며 일부 변형이 있습니다
- **형식 (12/15)**: 경미한 형식 조정이 필요합니다

## 품질 조정

### 더 높은 품질을 위해

1. **임계값 증가**:`--quality 95`
2. **더 많은 반복 허용**:`--max-iterations 6`
3. **더 나은 모델 사용**:`--model claude-sonnet-4-5-20250929`
4. **더 많은 컨텍스트 제공**: 구성에 문서 목적 추가

### 더 빠른 처리를 위해

1. **임계값 낮추기**:`--quality 75`
2. **반복 횟수 줄이기**:`--max-iterations 2`
3. **더 빠른 모델 사용**:`--model claude-haiku-4-5-20251001`

### 비용 대 품질 트레이드오프

| 설정 | 비용 | 시간 | 품질 |
|---------|------|------|---------|
| threshold=70, iterations=2 | 낮음 | 빠름 | 초안 |
| threshold=85, iterations=4 | 중간 | 보통 | 표준 |
| threshold=95, iterations=6 | 높음 | 느림 | 프리미엄 |

## 품질 문제 및 해결 방법

### 낮은 정확성 점수

**원인:**
- 모호한 원본 텍스트
- 누락된 컨텍스트
- 복잡한 기술 콘텐츠

**해결 방법:**
- 용어집 용어에 컨텍스트 추가
- 더 강력한 모델 사용
- 복잡한 문장을 더 간단한 문장으로 분해

### 낮은 유창성 점수

**원인:**
- 직역
- 부자연스러운 표현
- 잘못된 문체 (공식/비공식)

**해결 방법:**
- 최대 반복 횟수 증가
- 네이티브 품질 모델 사용 (Sonnet/GPT-4o)
- 원본 텍스트의 명확성 검토

### 낮은 용어집 준수

**원인:**
- 용어집에 없는 용어
- 대소문자 불일치
- 다른 형태로 나타나는 용어

**해결 방법:**
- 누락된 용어를 용어집에 추가
-`caseSensitive` 설정 확인
- 용어 변형 추가

### 낮은 형식 점수

**원인:**
- 복잡한 중첩 구조
- 주석이 있는 코드 블록
- 형식이 있는 표

**해결 방법:**
- Chunking이 구조를 존중하는지 확인
- Markdown 원본 검토
- 복잡한 콘텐츠 사전 처리 고려
