# 质量控制

::: info 翻译说明
所有非英文文档均使用 Claude Sonnet 4 自动翻译。
:::

llm-translate 使用 Self-Refine 算法来确保翻译质量满足您的要求。

## Self-Refine 工作原理

```
┌─────────────────┐
│ Initial Translate│
└────────┬────────┘
         ▼
┌─────────────────┐
│ Evaluate Quality │◀──────────────┐
└────────┬────────┘               │
         ▼                        │
    Score >= Threshold?           │
         │                        │
    No   │   Yes                  │
         │    │                   │
         ▼    ▼                   │
┌─────────┐ ┌──────┐              │
│ Reflect │ │ Done │              │
└────┬────┘ └──────┘              │
     ▼                            │
┌─────────────────┐               │
│    Improve      │───────────────┘
└─────────────────┘
```

### 1. 初始翻译

第一次翻译生成时包含：
- 完整术语表上下文
- 文档结构信息
- 前一个 chunk 的上下文（保持连续性）

### 2. 质量评估

每个翻译都会根据四个标准进行评分：

| 标准 | 权重 | 描述 |
|-----------|--------|-------------|
| 语义准确性 | 40% | 是否传达了正确的含义？ |
| 流畅度 | 25% | 在目标语言中读起来是否自然？ |
| 术语表合规性 | 20% | 是否正确应用了所有术语表条目？ |
| 格式保持 | 15% | 是否保持了 Markdown/HTML 结构？ |

### 3. 反思

如果质量低于阈值，LLM 会分析：
- 存在哪些具体问题
- 遗漏了哪些术语表条目
- 哪里可以改善流畅度

### 4. 改进

基于反思反馈应用针对性修复，然后重复循环。

## 配置

### 质量阈值

```bash
# CLI
llm-translate file doc.md -o doc.ko.md -s en -t ko --quality 90

# Config file
{
  "translation": {
    "qualityThreshold": 90
  }
}
```

### 最大迭代次数

```bash
# CLI
llm-translate file doc.md -o doc.ko.md -s en -t ko --max-iterations 6

# Config file
{
  "translation": {
    "maxIterations": 6
  }
}
```

### 严格模式

如果未达到质量阈值则失败：

```bash
llm-translate file doc.md -o doc.ko.md -s en -t ko --strict-quality
```

退出代码：
-`0`- 成功
-`4`- 未达到质量阈值（严格模式）

## 质量分数解释

| 分数 | 质量等级 | 描述 |
|-------|--------------|-------------|
| 95-100 | 优秀 | 可直接发布 |
| 85-94 | 良好 | 有轻微问题，大多数用途可接受 |
| 75-84 | 一般 | 有明显问题，可能需要审查 |
| 60-74 | 较差 | 有重大问题，需要人工审查 |
| < 60 | 不可接受 | 有严重问题，考虑重新翻译 |

## 理解输出

```
✓ Translation complete
  Quality: 92/85 (threshold met)
  Breakdown:
    - Accuracy: 38/40
    - Fluency: 24/25
    - Glossary: 18/20
    - Format: 12/15
  Iterations: 2
```

### 详细分析

- **准确性 (38/40)**：翻译在语义上正确
- **流畅度 (24/25)**：在目标语言中读起来自然
- **术语表 (18/20)**：大部分条目已应用，有些变化
- **格式 (12/15)**：需要轻微的格式调整

## 质量调优

### 提高质量
